<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BENTO Admin</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body {
  margin:0;
  background:#0e0e11;
  color:#fff;
  font-family:-apple-system,BlinkMacSystemFont;
}
#app { padding:20px; }
.card {
  background:#1c1c22;
  border-radius:16px;
  padding:16px;
}
button {
  width:100%;
  padding:14px;
  border:none;
  border-radius:14px;
  background:#8774e1;
  color:white;
  font-size:16px;
}
.error { color:#ff6b6b; }
</style>
</head>

<body>
<div id="app">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</div>

<script>
/* TELEGRAM */
if (!window.Telegram?.WebApp) {
  document.body.innerHTML = "‚ùå –¢–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Telegram";
  throw new Error("No Telegram");
}
const tg = Telegram.WebApp;
tg.expand();

const app = document.getElementById("app");
const user = tg.initDataUnsafe?.user;

/* SUPABASE */
const SUPABASE_URL = "https://duqqpuitipndkghpqupb.supabase.co"; // ‚Üê –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û
const SUPABASE_ANON_KEY = "sb_publishable_gN3Tyqs65cBJ0Ra9P7l0hQ_eB413MYU";   // ‚Üê –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û

const supabase = supabaseJs.createClient(
  SUPABASE_URL,
  SUPABASE_ANON_KEY
);

/* START */
if (!user) {
  app.innerHTML = "<div class='card error'>‚ùå –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö Telegram</div>";
  throw new Error("No user");
}

checkAdmin();

/* CHECK ADMIN */
async function checkAdmin() {
  try {
    const { data, error } = await supabase
      .from("admins")
      .select("id")
      .eq("id", user.id)
      .single();

    if (error || !data) {
      app.innerHTML = `
        <div class="card error">
          ‚õî –£ —Ç–µ–±—è –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞<br><br>
          ID: ${user.id}
        </div>
      `;
      return;
    }

    renderAdmin();

  } catch (e) {
    app.innerHTML = `
      <div class="card error">
        ‚ùå –û—à–∏–±–∫–∞ Supabase<br>
        ${e.message}
      </div>
    `;
  }
}

/* ADMIN UI */
function renderAdmin() {
  app.innerHTML = `
    <div class="card">
      <b>üëë BENTO ADMIN</b><br><br>
      ${user.first_name}<br>
      ID: ${user.id}<br><br>
      <button onclick="tg.close()">üö™ –í—ã–π—Ç–∏</button>
    </div>
  `;
}
</script>
</body>
</html>
